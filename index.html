<!doctype html>
<html lang="en" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>JhƒÅkri</title>
  <meta name="description" content="JhƒÅkri ‚Äì Upload image to generate protected output." />
  <meta name="theme-color" content="#b80d1c" />
  <style>
    :root {
      /* Light theme (default) */
      --bg: #ffffff;
      --surface: #ffffff;
      --surface-alt: #fafafa;
      --muted: #6b6b6b;
      --text: #111111;
      --text-dim: #333333;
      --border: #e6e6e6;
      --accent-500: #f43f5e;
      --accent-600: #e11d48;
      --accent-700: #b80d1c; /* brand primary */
      --accent-800: #8a0e16;
      --shadow-1: 0 6px 18px rgba(0,0,0,.08);
      --shadow-2: 0 6px 20px rgba(184,13,28,.15);
      --radius-lg: 12px;
      --radius-xl: 20px;
    }
    [data-theme="dark"] {
      --bg: #0f0f0f;
      --surface: #1a1a1a;
      --surface-alt: #222222;
      --muted: #bdbdbd;
      --text: #f5f5f5;
      --text-dim: #e2e2e2;
      --border: #2f2f2f;
      --shadow-1: 0 6px 18px rgba(0,0,0,.55);
      --shadow-2: 0 6px 20px rgba(184,13,28,.35);
    }

    * { box-sizing: border-box; }
    html, body { height: 100%; }
    body {
      margin: 0; background: var(--bg); color: var(--text);
      font: 16px/1.55 "Inter", "Manrope", system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, Cantarell, Noto Sans, Helvetica, Arial, "Apple Color Emoji", "Segoe UI Emoji";
      -webkit-font-smoothing: antialiased; -moz-osx-font-smoothing: grayscale;
    }

    a { color: var(--accent-700); text-decoration: none; }
    a:hover { text-decoration: underline; }

    header.site { position: sticky; top: 0; z-index: 50; background: rgba(255,255,255,.8); backdrop-filter: saturate(1.2) blur(10px); border-bottom: 1px solid var(--border); }
    [data-theme="dark"] header.site { background: rgba(15,15,15,.85); }

    .brand { display:flex; align-items:center; gap:12px; }
    .logo { width:38px; height:38px; border-radius:10px; background: linear-gradient(145deg, var(--accent-800), var(--accent-700)); display:grid; place-items:center; color:#fff; font-weight:800; }
    .brand h1 { margin:0; font-size:22px; font-weight:800; }

    .container { max-width:1120px; margin:0 auto; padding:24px; }
    .hero { padding:48px 24px 12px; text-align:center; }
    .hero h2 { font-size: clamp(32px, 4vw, 46px); font-weight: 900; margin:0 0 10px; }
    .hero p { color: var(--text-dim); max-width: 760px; margin: 0 auto; }

    .card { background: var(--surface); border:1px solid var(--border); border-radius: var(--radius-xl); box-shadow: var(--shadow-1); padding:32px; }

    /* Two-column IO grid with consistent heights */
    .io-grid { display:grid; grid-template-columns: 1fr 1fr; gap: 40px; align-items: start; }
    @media (max-width: 980px){ .io-grid { grid-template-columns: 1fr; gap: 32px; } }

    label { font-weight: 700; color: var(--text); display:block; margin-bottom:12px; font-size: 18px; }
    .hint { color: var(--muted); font-size: 13px; margin-top: 8px; font-weight: 500; line-height: 1.4; }

    .file-btn { display:inline-flex; align-items:center; gap:10px; padding:12px 18px; border-radius:12px; border:1px solid #e6e6e6; background: #fafafa; cursor:pointer; font-weight:700; transition: all 0.2s ease; position: relative; z-index: 10; pointer-events: auto; color: #111111; }
    .file-btn:hover { transform: translateY(-1px); box-shadow: var(--shadow-1); }
    input[type="file"] { display:none; }

    .dropzone { 
      border: 2px dashed var(--accent-700); 
      border-radius: 16px; 
      background: rgba(184,13,28,.06); 
      padding: 24px; 
      text-align:center; 
      transition: all 0.3s ease;
      position: relative;
      overflow: hidden;
    }
    .dropzone.dragover { 
      background: rgba(184,13,28,.12); 
      transform: scale(1.02);
      border-color: var(--accent-600);
    }

    /* Processing animation */
    .dropzone.processing {
      animation: pulse 2s infinite;
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); opacity: 1; }
      50% { transform: scale(1.02); opacity: 0.8; }
    }

    .processing-overlay {
      position: absolute;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(184,13,28,.1);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.3s ease;
    }
    .processing-overlay.active {
      opacity: 1;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border);
      border-top: 3px solid var(--accent-700);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }
    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    .image-container { margin-top: 16px; }
    .image-preview, .output-preview {
      width: 100%;
      max-width: 100%;
      height: 320px;
      border: 1px solid var(--border);
      border-radius: 12px;
      overflow: hidden;
      background: #ffffff;
      display: flex;
      align-items: center;
      justify-content: center;
      position: relative;
    }

    .image-preview img, .output-preview img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }

    .image-info {
      position: absolute;
      bottom: 0;
      left: 0;
      right: 0;
      background: linear-gradient(transparent, rgba(0,0,0,0.7));
      color: white;
      padding: 12px;
      font-size: 12px;
      font-weight: 600;
    }

    .placeholder {
      color: var(--muted);
      font-size: 14px;
      text-align: center;
      padding: 20px;
    }

    .toolbar { 
      display: flex; 
      flex-wrap: wrap; 
      gap: 12px; 
      margin-top: 24px; 
      align-items: center;
      justify-content: flex-start;
    }
    @media (max-width: 640px) {
      .toolbar { flex-direction: column; align-items: stretch; }
      .toolbar .btn { justify-content: center; }
    }

    .btn { 
      border: 0; 
      cursor: pointer; 
      font-weight: 800; 
      padding: 14px 20px; 
      border-radius: 12px; 
      transition: all 0.2s ease;
      font-size: 14px;
      display: inline-flex;
      align-items: center;
      gap: 8px;
      white-space: nowrap;
    }
    .btn.primary { 
      background: linear-gradient(145deg, var(--accent-800), var(--accent-700)); 
      color: #fff; 
      box-shadow: var(--shadow-2); 
    }
    .btn.secondary { 
      background: #fafafa; 
      color: #111111; 
      border: 1px solid #e6e6e6; 
    }
    .btn.ghost { 
      background: transparent; 
      color: #666666; 
      border: 1px dashed #e6e6e6; 
    }
    .btn:hover:not(:disabled) { 
      transform: translateY(-2px); 
      filter: brightness(1.05);
    }
    .btn:disabled {
      opacity: 0.6;
      cursor: not-allowed;
    }

    .status {
      margin-top: 16px;
      padding: 12px 16px;
      border-radius: 8px;
      font-size: 14px;
      font-weight: 600;
      opacity: 0;
      transition: all 0.3s ease;
    }
    .status.show {
      opacity: 1;
    }
    .status.processing {
      background: rgba(184,13,28,.1);
      color: var(--accent-700);
      border: 1px solid rgba(184,13,28,.2);
    }
    .status.success {
      background: rgba(34,197,94,.1);
      color: #059669;
      border: 1px solid rgba(34,197,94,.2);
    }

    footer.site { margin-top: 48px; padding: 24px; color: var(--muted); border-top: 1px solid var(--border); text-align: center; font-size: 14px; }
  </style>
</head>
<body>
  <header class="site">
    <div class="container" style="padding-top:12px;padding-bottom:12px;display:flex;align-items:center;justify-content:space-between;">
      <div class="brand"><div class="logo">J·∏§</div><h1>JhƒÅkri</h1></div>
      <button class="btn secondary" id="themeToggle" title="Toggle dark mode">üåô Dark mode</button>
    </div>
  </header>

  <main class="container">
    <section class="hero">
      <h2>Harden your images against AI replication</h2>
      <p>Upload a single image and JhƒÅkri will return a protected version using advanced anti-AI techniques.</p>
    </section>

    <section class="card" aria-labelledby="modeLabel">
      <div class="io-grid">
        <!-- Left: Input -->
        <div>
          <label for="img-drop">Upload Image</label>
          <div id="img-drop" class="dropzone" tabindex="0" aria-label="Drop image here or choose file">
            <div class="processing-overlay" id="processing-overlay">
              <div class="spinner"></div>
            </div>
            <p style="margin:8px 0 12px; font-weight: 600;">Drag & drop your image here</p>
            <button class="file-btn" id="choose-btn" type="button">
              üñºÔ∏è Choose Image
            </button>
            <input id="image-file" type="file" accept="image/*" style="display: none;" />
            <p class="hint">Supports JPG, PNG, GIF, WebP formats ‚Ä¢ Max 10MB</p>
          </div>
          
          <div class="image-container">
            <div class="image-preview" id="image-preview">
              <div class="placeholder">No image selected</div>
            </div>
          </div>
        </div>

        <!-- Right: Output -->
        <div>
          <label for="output-preview">Protected Output</label>
          <div class="image-container">
            <div class="output-preview" id="output-preview">
              <div class="placeholder">Generated image will appear here</div>
            </div>
          </div>
          
          <div class="toolbar">
            <button class="btn primary" id="processBtnImg" disabled>
              ‚ö° Generate Anti‚ÄëAI Output
            </button>
            <button class="btn secondary" id="downloadBtnImg" disabled>
              üíæ Download
            </button>
            <button class="btn ghost" id="clearBtnImg" disabled>
              üóëÔ∏è Clear
            </button>
          </div>
          <div class="status" id="status-img" aria-live="polite"></div>
        </div>
      </div>
    </section>
  </main>

  <footer class="site">
    <small>Owned and operated by <a href="https://northbridgeit.ca/" target="_blank" rel="noopener">NorthBridge IT Solutions</a>.</small>
  </footer>

  <script>
    const $ = (sel, ctx=document) => ctx.querySelector(sel);

    // Theme toggle
    const themeBtn = $('#themeToggle');
    themeBtn.addEventListener('click', () => {
      const root = document.documentElement;
      const dark = root.getAttribute('data-theme') === 'dark';
      root.setAttribute('data-theme', dark ? 'light' : 'dark');
      themeBtn.innerHTML = dark ? 'üåô Dark mode' : '‚òÄÔ∏è Light mode';
    });

    // Single image handling
    let currentImageFile = null;
    const imagePreview = $('#image-preview');
    const outputPreview = $('#output-preview');
    const statusImg = $('#status-img');
    const processBtn = $('#processBtnImg');
    const downloadBtn = $('#downloadBtnImg');
    const clearBtn = $('#clearBtnImg');
    const dropzone = $('#img-drop');
    const processingOverlay = $('#processing-overlay');

    function showStatus(message, type = 'processing') {
      statusImg.textContent = message;
      statusImg.className = `status show ${type}`;
    }

    function hideStatus() {
      statusImg.className = 'status';
    }

    function updateButtons() {
      const hasImage = currentImageFile !== null;
      processBtn.disabled = !hasImage;
      clearBtn.disabled = !hasImage;
      
      // Download button enabled only after processing
      const hasOutput = outputPreview.querySelector('img') !== null;
      downloadBtn.disabled = !hasOutput;
    }

    function displayImage(file, container) {
      const img = document.createElement('img');
      const info = document.createElement('div');
      info.className = 'image-info';
      info.textContent = `${file.name} ‚Ä¢ ${(file.size/1024/1024).toFixed(2)} MB`;
      
      const reader = new FileReader();
      reader.onload = e => {
        img.src = e.target.result;
        container.innerHTML = '';
        container.appendChild(img);
        container.appendChild(info);
      };
      reader.readAsDataURL(file);
    }

    function clearAll() {
      currentImageFile = null;
      imagePreview.innerHTML = '<div class="placeholder">No image selected</div>';
      outputPreview.innerHTML = '<div class="placeholder">Generated image will appear here</div>';
      document.getElementById('image-file').value = '';
      hideStatus();
      updateButtons();
    }

    // File input handler
    const fileInput = document.getElementById('image-file');
    const chooseBtn = document.getElementById('choose-btn');
    
    console.log('File input:', fileInput);
    console.log('Choose button:', chooseBtn);
    
    // Make choose button work
    if (chooseBtn && fileInput) {
      chooseBtn.addEventListener('click', (e) => {
        console.log('Choose button clicked!');
        e.preventDefault();
        e.stopPropagation();
        fileInput.click();
      });
    }
    
    if (fileInput) {
      fileInput.addEventListener('change', (e) => {
        console.log('File input changed:', e.target.files);
        const file = e.target.files[0];
        if (file && file.type.startsWith('image/')) {
          console.log('Valid image file:', file.name);
          currentImageFile = file;
          displayImage(file, imagePreview);
          outputPreview.innerHTML = '<div class="placeholder">Generated image will appear here</div>';
          updateButtons();
          hideStatus();
        }
      });
    }

    // Drag & drop handlers
    ['dragenter', 'dragover'].forEach(eventName => {
      dropzone.addEventListener(eventName, (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropzone.classList.add('dragover');
      });
    });

    ['dragleave', 'drop'].forEach(eventName => {
      dropzone.addEventListener(eventName, (e) => {
        e.preventDefault();
        e.stopPropagation();
        dropzone.classList.remove('dragover');
      });
    });

    dropzone.addEventListener('drop', (e) => {
      const files = Array.from(e.dataTransfer.files);
      const imageFile = files.find(file => file.type.startsWith('image/'));
      
      if (imageFile) {
        currentImageFile = imageFile;
        displayImage(imageFile, imagePreview);
        outputPreview.innerHTML = '<div class="placeholder">Generated image will appear here</div>';
        updateButtons();
        hideStatus();
      }
    });

    // Process button handler with animation
    processBtn.addEventListener('click', async () => {
      if (!currentImageFile) return;

      // Start processing animation
      dropzone.classList.add('processing');
      processingOverlay.classList.add('active');
      showStatus('Generating anti-AI protection...', 'processing');
      processBtn.disabled = true;

      // Simulate processing time
      await new Promise(resolve => setTimeout(resolve, 2000));

      // Stop animation
      dropzone.classList.remove('processing');
      processingOverlay.classList.remove('active');

      // Display "processed" image (currently just mirrors the input)
      displayImage(currentImageFile, outputPreview);
      
      showStatus('Anti-AI protection applied successfully!', 'success');
      processBtn.disabled = false;
      updateButtons();

      // Hide success message after 3 seconds
      setTimeout(() => hideStatus(), 3000);
    });

    // Download handler
    downloadBtn.addEventListener('click', () => {
      if (!currentImageFile) return;
      
      const url = URL.createObjectURL(currentImageFile);
      const a = document.createElement('a');
      const filename = currentImageFile.name.replace(/\.[^/.]+$/, '') + '_protected.png';
      a.href = url;
      a.download = filename;
      document.body.appendChild(a);
      a.click();
      a.remove();
      setTimeout(() => URL.revokeObjectURL(url), 1000);
    });

    // Clear button handler
    clearBtn.addEventListener('click', clearAll);

    // Initialize button states
    updateButtons();
  </script>
</body>
</html>
